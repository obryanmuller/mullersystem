// Declara o provedor do cliente Prisma
generator client {
  provider = "prisma-client-js"
}

// Configura a fonte de dados, apontando para a URL no seu arquivo .env
datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
}

// --- MODELOS EXISTENTES ATUALIZADOS ---

model Produto {
  id          Int      @id @default(autoincrement())
  nome        String
  sku         String   @unique
  preco       Decimal  @db.Decimal(10, 2)
  quantidade  Int
  estoqueMinimo Int @default(10) // <-- NOVO CAMPO: Valor padrão 10
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // RELACIONAMENTO: Um produto pode estar em muitos itens de venda
  itensVenda  ItemVenda[]
}

model Cliente {
  id            Int      @id @default(autoincrement())
  nome          String
  email         String   @unique
  telefone      String?
  cpf           String   @unique
  status        String   @default("Ativo")
  totalCompras  Decimal  @default(0) @db.Decimal(10, 2)
  enderecoRua   String
  enderecoBairro String
  enderecoCidade String
  enderecoEstado String
  enderecoRef   String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // RELACIONAMENTO: Um cliente pode ter muitas vendas
  vendas        Venda[]
  // RELACIONAMENTO: Um cliente pode ter muitas pendências
  pendencias    Pendencia[]
}


// --- NOVOS MODELOS PARA A FUNCIONALIDADE DE VENDAS ---

model Venda {
  id          Int      @id @default(autoincrement())
  total       Decimal  @db.Decimal(10, 2)
  pagamento   String
  createdAt   DateTime @default(now())

  // RELACIONAMENTO: A venda pode pertencer a um cliente (opcional)
  clienteId   Int?
  cliente     Cliente? @relation(fields: [clienteId], references: [id])

  // RELACIONAMENTO: Uma venda é composta por vários itens
  itens       ItemVenda[]
  // RELACIONAMENTO: Uma venda pode gerar uma ou mais pendências
  pendencias  Pendencia[]
}

model ItemVenda {
  id         Int   @id @default(autoincrement())
  quantidade Int
  preco      Decimal @db.Decimal(10, 2) // Preço do produto no momento da venda

  // RELACIONAMENTO: A qual venda este item pertence
  vendaId    Int
  venda      Venda @relation(fields: [vendaId], references: [id])

  // RELACIONAMENTO: Qual produto foi vendido
  produtoId  Int
  produto    Produto @relation(fields: [produtoId], references: [id])
}

model MovimentacaoCaixa {
  id          Int      @id @default(autoincrement())
  tipo        String   // 'ENTRADA' ou 'SAIDA'
  valor       Decimal  @db.Decimal(10, 2)
  descricao   String
  dataHora    DateTime @default(now())
}

model Pendencia {
  id          Int      @id @default(autoincrement())
  vendaId     Int
  venda       Venda    @relation(fields: [vendaId], references: [id], onDelete: Cascade)
  clienteId   Int
  cliente     Cliente  @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  valor       Decimal  @db.Decimal(10, 2)
  descricao   String
  dataPendencia DateTime @default(now())
  dataVencimento DateTime?
  dataPago    DateTime?
  status      String   @default("ABERTA") // 'ABERTA', 'PAGA', 'ATRASADA'
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model User {
  id            Int      @id @default(autoincrement())
  email         String   @unique
  passwordHash  String
  role          String   @default("COMMON") // 'MASTER' ou 'COMMON'
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}